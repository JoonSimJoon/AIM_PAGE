'use client'

import { useState, useEffect } from 'react'
import ReactMarkdown from 'react-markdown'
import remarkGfm from 'remark-gfm'
import { Button, Card, Text, Title, Subtitle, Loading, Modal } from '@/components/ui'

interface RecruitNotice {
  id: string
  title: string
  bodyMd: string
  startAt: string
  endAt: string
  isOpen: boolean
  externalFormUrl?: string
  targetAudience?: string
  recruitCount?: string
  recruitMethod?: string
  shortDescription?: string
  createdAt: string
  updatedAt: string
}

interface FormData {
  title: string
  bodyMd: string
  startAt: string
  endAt: string
  isOpen: boolean
  externalFormUrl: string
  targetAudience: string
  recruitCount: string
  recruitMethod: string
  shortDescription: string
}

export default function RecruitManagementPage() {
  const [notices, setNotices] = useState<RecruitNotice[]>([])
  const [loading, setLoading] = useState(true)
  const [showModal, setShowModal] = useState(false)
  const [editingNotice, setEditingNotice] = useState<RecruitNotice | null>(null)
  const [initialFormData, setInitialFormData] = useState<FormData | null>(null)
  const [hasChanges, setHasChanges] = useState(false)
  const [showConfirmDialog, setShowConfirmDialog] = useState(false)
  const [notification, setNotification] = useState<{
    show: boolean
    type: 'success' | 'error' | 'warning' | 'info'
    title: string
    message?: string
    onConfirm?: () => void
    confirmText?: string
    showCancel?: boolean
  }>({
    show: false,
    type: 'info',
    title: '',
    message: '',
    onConfirm: undefined,
    confirmText: 'í™•ì¸',
    showCancel: false
  })
  const [formData, setFormData] = useState<FormData>({
    title: '',
    bodyMd: '',
    startAt: '',
    endAt: '',
    isOpen: true,
    externalFormUrl: '',
    targetAudience: '',
    recruitCount: '',
    recruitMethod: '',
    shortDescription: ''
  })

  useEffect(() => {
    document.title = 'Recruit Management - AIM: AI Monsters'
    fetchNotices()
  }, [])

  // í¼ ë°ì´í„° ë³€ê²½ ê°ì§€
  useEffect(() => {
    if (initialFormData) {
      const hasChanged = JSON.stringify(formData) !== JSON.stringify(initialFormData)
      setHasChanges(hasChanged)
    }
  }, [formData, initialFormData])


  const fetchNotices = async () => {
    try {
      const token = localStorage.getItem('token')
      const response = await fetch('http://localhost:3001/api/content/recruit/all', {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      })
      
      if (response.ok) {
        const data = await response.json()
        setNotices(data)
      }
    } catch (error) {
      console.error('ëª¨ì§‘ ê³µê³  ì¡°íšŒ ì˜¤ë¥˜:', error)
    } finally {
      setLoading(false)
    }
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    
    if (!formData.title.trim() || !formData.bodyMd.trim()) {
      showNotification('warning', 'ì…ë ¥ í•„ìˆ˜', 'ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.')
      return
    }

    try {
      const token = localStorage.getItem('token')
      const url = editingNotice 
        ? `http://localhost:3001/api/content/recruit/${editingNotice.id}`
        : 'http://localhost:3001/api/content/recruit'
      
      const method = editingNotice ? 'PUT' : 'POST'
      
      const response = await fetch(url, {
        method,
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(formData)
      })

      if (response.ok) {
        setShowModal(false)
        setEditingNotice(null)
        setInitialFormData(null)
        setHasChanges(false)
        setFormData({
          title: '',
          bodyMd: '',
          startAt: '',
          endAt: '',
          isOpen: true,
          externalFormUrl: '',
          targetAudience: '',
          recruitCount: '',
          recruitMethod: '',
          shortDescription: ''
        })
        fetchNotices()
        showNotification('success', editingNotice ? 'ìˆ˜ì • ì™„ë£Œ' : 'ì‘ì„± ì™„ë£Œ', 
          editingNotice ? 'ëª¨ì§‘ ê³µê³ ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ëª¨ì§‘ ê³µê³ ê°€ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.')
      } else {
        showNotification('error', 'ì €ì¥ ì‹¤íŒ¨', 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')
      }
    } catch (error) {
      console.error('ì €ì¥ ì˜¤ë¥˜:', error)
      showNotification('error', 'ì˜¤ë¥˜ ë°œìƒ', 'ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')
    }
  }

  const handleEdit = (notice: RecruitNotice) => {
    setEditingNotice(notice)
    const newFormData = {
      title: notice.title,
      bodyMd: notice.bodyMd,
      startAt: new Date(notice.startAt).toISOString().slice(0, 16),
      endAt: new Date(notice.endAt).toISOString().slice(0, 16),
      isOpen: notice.isOpen,
      externalFormUrl: notice.externalFormUrl || '',
      targetAudience: notice.targetAudience || '',
      recruitCount: notice.recruitCount || '',
      recruitMethod: notice.recruitMethod || '',
      shortDescription: notice.shortDescription || ''
    }
    setFormData(newFormData)
    setInitialFormData(newFormData)
    setHasChanges(false)
    setShowModal(true)
  }

  const handleDelete = async (id: string) => {
    showNotification('warning', 'ì‚­ì œ í™•ì¸', 'ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?', 
      () => performDelete(id), 'ì‚­ì œ', true)
  }

  const performDelete = async (id: string) => {

    try {
      const token = localStorage.getItem('token')
      const response = await fetch(`http://localhost:3001/api/content/recruit/${id}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${token}`
        }
      })

      if (response.ok) {
        fetchNotices()
        showNotification('success', 'ì‚­ì œ ì™„ë£Œ', 'ëª¨ì§‘ ê³µê³ ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.')
      } else {
        showNotification('error', 'ì‚­ì œ ì‹¤íŒ¨', 'ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.')
      }
    } catch (error) {
      console.error('ì‚­ì œ ì˜¤ë¥˜:', error)
      showNotification('error', 'ì˜¤ë¥˜ ë°œìƒ', 'ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')
    }
  }

  const openAddModal = () => {
    setEditingNotice(null)
    const newFormData = {
      title: '',
      bodyMd: '',
      startAt: '',
      endAt: '',
      isOpen: true,
      externalFormUrl: '',
      targetAudience: '',
      recruitCount: '',
      recruitMethod: '',
      shortDescription: ''
    }
    setFormData(newFormData)
    setInitialFormData(newFormData)
    setHasChanges(false)
    setShowModal(true)
  }

  const loadTemplate = () => {
    const template = `# ğŸ“‹ ëª¨ì§‘ ê°œìš”

## ëª¨ì§‘ ëŒ€ìƒ
êµ­ë¯¼ëŒ€í•™êµ ì¬í•™ìƒ (í•™ê³¼ ë¬´ê´€)

## ëª¨ì§‘ ì¸ì›
15ëª… ë‚´ì™¸

## ì§€ì› ê¸°ê°„
2025ë…„ 3ì›” ~ 3ì›” ë§

## í™œë™ ê¸°ê°„
2025ë…„ 3ì›” ~ 12ì›”

---

# âœ… ì§€ì› ìê²©

- âœ“ êµ­ë¯¼ëŒ€í•™êµ ì¬í•™ìƒ (í•™ê³¼ ë¬´ê´€, í•™ë…„ ë¬´ê´€)
- âœ“ AI/MLì— ëŒ€í•œ ê´€ì‹¬ê³¼ ì—´ì •ì´ ìˆëŠ” í•™ìƒ
- âœ“ ë™ì•„ë¦¬ í™œë™ì— ì ê·¹ì ìœ¼ë¡œ ì°¸ì—¬í•  ì˜ì§€ê°€ ìˆëŠ” í•™ìƒ
- âœ“ í”„ë¡œê·¸ë˜ë° ê²½í—˜ ìš°ëŒ€ (í•„ìˆ˜ ì•„ë‹˜)
- âœ“ íŒ€ì›Œí¬ì™€ ì†Œí†µ ëŠ¥ë ¥ì„ ê°–ì¶˜ í•™ìƒ

---

# ğŸš€ ì£¼ìš” í™œë™

## ì •ê¸° ì„¸ë¯¸ë‚˜
- ë§¤ì£¼ AI/ML ê´€ë ¨ ê¸°ìˆ  ì„¸ë¯¸ë‚˜
- ìµœì‹  ë…¼ë¬¸ ë¦¬ë·° ë° í† ë¡ 
- í”„ë¡œì íŠ¸ ì§„í–‰ ìƒí™© ê³µìœ 

## í”„ë¡œì íŠ¸
- íŒ€ ë‹¨ìœ„ AI í”„ë¡œì íŠ¸ ìˆ˜í–‰
- ê°œì¸/íŒ€ í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì¶•
- ëŒ€ì™¸ ëŒ€íšŒ ì°¸ê°€ ì§€ì›

## ìŠ¤í„°ë””
- ê¸°ì´ˆ í”„ë¡œê·¸ë˜ë° (Python)
- ë¨¸ì‹ ëŸ¬ë‹/ë”¥ëŸ¬ë‹ ê¸°ì´ˆ
- ìë£Œêµ¬ì¡° & ì•Œê³ ë¦¬ì¦˜

## ë„¤íŠ¸ì›Œí‚¹
- í˜„ì—… ì „ë¬¸ê°€ íŠ¹ê°•
- ì¡¸ì—…ìƒ ë©˜í† ë§
- IT ê¸°ì—… ê²¬í•™

---

# ğŸ“ ì§€ì› ì ˆì°¨

1. **ì˜¨ë¼ì¸ ì§€ì›ì„œ ì‘ì„±**
   - ê°œì¸ì •ë³´ ë° ì§€ì› ë™ê¸°
   - í¬íŠ¸í´ë¦¬ì˜¤ (ìˆëŠ” ê²½ìš°)

2. **ì„œë¥˜ ì‹¬ì‚¬**
   - ì§€ì›ì„œ ê¸°ë°˜ 1ì°¨ ì‹¬ì‚¬

3. **ë©´ì ‘ ì‹¬ì‚¬**
   - ê°œë³„ ë©´ì ‘ (20ë¶„ ë‚´ì™¸)
   - ì§€ì› ë™ê¸° ë° í™œë™ ê³„íš

4. **ìµœì¢… ë°œí‘œ**
   - ê°œë³„ ì—°ë½ ë° í™ˆí˜ì´ì§€ ê³µì§€

---

# ğŸ’¡ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸

**Q: í”„ë¡œê·¸ë˜ë°ì„ ì „í˜€ ëª¨ë¥´ëŠ”ë° ì§€ì›í•  ìˆ˜ ìˆë‚˜ìš”?**
A: ë„¤! ì—´ì •ê³¼ ì˜ì§€ë§Œ ìˆë‹¤ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤. ê¸°ì´ˆë¶€í„° ì°¨ê·¼ì°¨ê·¼ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤.

**Q: ë‹¤ë¥¸ ë™ì•„ë¦¬ì™€ ì¤‘ë³µ ê°€ì…ì´ ê°€ëŠ¥í•œê°€ìš”?**
A: ê°€ëŠ¥í•˜ì§€ë§Œ, AIM í™œë™ì— ì ê·¹ì ìœ¼ë¡œ ì°¸ì—¬í•  ìˆ˜ ìˆëŠ”ì§€ ê³ ë ¤í•´ì£¼ì„¸ìš”.

**Q: í•™ê³¼ ì œí•œì´ ìˆë‚˜ìš”?**
A: ì—†ìŠµë‹ˆë‹¤! ëª¨ë“  í•™ê³¼ í•™ìƒì„ í™˜ì˜í•©ë‹ˆë‹¤.

**Q: í™œë™ë¹„ê°€ ìˆë‚˜ìš”?**
A: ê¸°ë³¸ í™œë™ë¹„ëŠ” ì—†ìœ¼ë©°, í•„ìš”ì‹œ ë™ì•„ë¦¬ì—ì„œ ì§€ì›í•©ë‹ˆë‹¤.`

    setFormData({
      ...formData,
      bodyMd: template
    })
  }

  const closeModal = () => {
    if (hasChanges) {
      setShowConfirmDialog(true)
    } else {
      setShowModal(false)
      setEditingNotice(null)
      setInitialFormData(null)
      setHasChanges(false)
    }
  }

  const confirmClose = () => {
    setShowModal(false)
    setEditingNotice(null)
    setInitialFormData(null)
    setHasChanges(false)
    setShowConfirmDialog(false)
  }

  const saveAndClose = async () => {
    // ë¨¼ì € ì €ì¥ ì‹œë„
    await handleSubmit(new Event('submit') as any)
    // handleSubmitì—ì„œ ì´ë¯¸ ëª¨ë‹¬ì´ ë‹«íˆë¯€ë¡œ ì¶”ê°€ ì‘ì—… ë¶ˆí•„ìš”
    setShowConfirmDialog(false)
  }

  const cancelClose = () => {
    setShowConfirmDialog(false)
  }

  // ì•Œë¦¼ í—¬í¼ í•¨ìˆ˜ë“¤
  const showNotification = (
    type: 'success' | 'error' | 'warning' | 'info',
    title: string,
    message?: string,
    onConfirm?: () => void,
    confirmText?: string,
    showCancel?: boolean
  ) => {
    setNotification({
      show: true,
      type,
      title,
      message,
      onConfirm,
      confirmText: confirmText || 'í™•ì¸',
      showCancel: showCancel || false
    })
  }

  const hideNotification = () => {
    setNotification(prev => ({ ...prev, show: false }))
  }

  const handleNotificationConfirm = () => {
    if (notification.onConfirm) {
      notification.onConfirm()
    }
    hideNotification()
  }


  if (loading) {
    return (
      <div className="flex justify-center items-center min-h-96">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500"></div>
      </div>
    )
  }

  return (
    <div className="space-y-6">
      {/* í—¤ë” */}
      <div className="flex justify-between items-center">
        <div>
          <h1 className="text-3xl font-bold text-white">ëª¨ì§‘ ê³µê³  ê´€ë¦¬</h1>
          <p className="text-gray-400 mt-2">ë™ì•„ë¦¬ ëª¨ì§‘ ê³µê³ ë¥¼ ì‘ì„±í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”.</p>
        </div>
        <button
          onClick={openAddModal}
          className="bg-cyan-600 text-white px-6 py-3 rounded-lg hover:bg-cyan-700 transition-colors font-medium"
        >
          + ìƒˆ ëª¨ì§‘ ê³µê³  ì‘ì„±
        </button>
      </div>

      {/* ëª¨ì§‘ ê³µê³  ëª©ë¡ */}
      <div className="space-y-6">
        {notices.length === 0 ? (
          <div className="text-center py-16 bg-gray-800 rounded-lg border border-gray-700">
            <div className="text-6xl mb-4">ğŸ“¢</div>
            <h3 className="text-xl font-semibold text-white mb-2">ë“±ë¡ëœ ëª¨ì§‘ ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
            <p className="text-gray-400 mb-6">ìƒˆë¡œìš´ ëª¨ì§‘ ê³µê³ ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
            <button
              onClick={openAddModal}
              className="bg-cyan-600 text-white px-6 py-3 rounded-lg hover:bg-cyan-700 transition-colors"
            >
              + ì²« ë²ˆì§¸ ëª¨ì§‘ ê³µê³  ì‘ì„±í•˜ê¸°
            </button>
          </div>
        ) : (
          notices.map((notice) => (
            <div key={notice.id} className="bg-gray-800 rounded-lg shadow-lg border border-gray-700 p-6">
              <div className="flex justify-between items-start mb-4">
                <div className="flex-1">
                  <div className="flex items-center space-x-3 mb-2">
                    <h3 className="text-xl font-semibold text-white">{notice.title}</h3>
                    <div className="flex space-x-2">
                      <span className={`px-3 py-1 rounded-full text-sm font-medium ${
                        notice.isOpen 
                          ? 'bg-green-600 text-white' 
                          : 'bg-gray-600 text-white'
                      }`}>
                        {notice.isOpen ? 'ğŸŸ¢ ëª¨ì§‘ì¤‘' : 'â¹ï¸ ëª¨ì§‘ë§ˆê°'}
                      </span>
                      {notice.isOpen && new Date(notice.endAt) < new Date() && (
                        <span className="px-3 py-1 rounded-full text-sm font-medium bg-yellow-600 text-white">
                          â° ê¸°ê°„ë§Œë£Œ
                        </span>
                      )}
                    </div>
                  </div>
                  <div className="text-gray-400 text-sm space-y-1">
                    <p>ëª¨ì§‘ ê¸°ê°„: {new Date(notice.startAt).toLocaleDateString()} ~ {new Date(notice.endAt).toLocaleDateString()}</p>
                    {notice.externalFormUrl && (
                      <p>ì§€ì› ë§í¬: <a href={notice.externalFormUrl} target="_blank" rel="noopener noreferrer" className="text-cyan-400 hover:text-cyan-300">{notice.externalFormUrl}</a></p>
                    )}
                    <p>ì‘ì„±ì¼: {new Date(notice.createdAt).toLocaleDateString()}</p>
                    {notice.updatedAt !== notice.createdAt && (
                      <p>ìˆ˜ì •ì¼: {new Date(notice.updatedAt).toLocaleDateString()}</p>
                    )}
                  </div>
                </div>
                <div className="flex space-x-2">
                  <button
                    onClick={() => handleEdit(notice)}
                    className="flex items-center space-x-1 text-cyan-400 hover:text-cyan-300 text-sm px-3 py-2 bg-gray-700 rounded border border-gray-600 hover:border-cyan-500 transition-colors"
                  >
                    <span>âœï¸</span>
                    <span>ìˆ˜ì •</span>
                  </button>
                  <button
                    onClick={() => handleDelete(notice.id)}
                    className="flex items-center space-x-1 text-red-400 hover:text-red-300 text-sm px-3 py-2 bg-gray-700 rounded border border-gray-600 hover:border-red-500 transition-colors"
                  >
                    <span>ğŸ—‘ï¸</span>
                    <span>ì‚­ì œ</span>
                  </button>
                </div>
              </div>
              
              <div className="bg-gray-700 border border-gray-600 rounded p-4">
                <h4 className="text-white font-medium mb-2">ë‚´ìš© ë¯¸ë¦¬ë³´ê¸°:</h4>
                <div className="text-gray-300 text-sm max-h-32 overflow-y-auto whitespace-pre-wrap">
                  {notice.bodyMd.length > 200 ? `${notice.bodyMd.substring(0, 200)}...` : notice.bodyMd}
                </div>
              </div>
            </div>
          ))
        )}
      </div>

      {/* ëª¨ë‹¬ */}
      <Modal
        isOpen={showModal}
        onClose={closeModal}
        title={editingNotice ? `ëª¨ì§‘ ê³µê³  ìˆ˜ì •: ${editingNotice.title}` : 'ìƒˆ ëª¨ì§‘ ê³µê³  ì‘ì„±'}
        onSubmit={handleSubmit}
        submitText={editingNotice ? 'ìˆ˜ì •' : 'ìƒì„±'}
        maxWidth="4xl"
      >
              <div>
                <label className="block text-white font-medium mb-2">ì œëª© *</label>
                <input
                  type="text"
                  value={formData.title}
                  onChange={(e) => setFormData({...formData, title: e.target.value})}
                  className="w-full bg-gray-700 border border-gray-600 text-white px-4 py-2 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
                  placeholder="ëª¨ì§‘ ê³µê³  ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
                  required
                />
              </div>

              {/* ì¹´ë“œ í‘œì‹œìš© í•„ë“œë“¤ */}
              <div className="bg-gray-700/50 rounded-lg p-6 border border-gray-600">
                <h3 className="text-lg font-semibold text-white mb-4 flex items-center">
                  <span className="w-2 h-6 bg-gradient-to-b from-cyan-500 to-pink-500 rounded-full mr-2"></span>
                  ì¹´ë“œ í‘œì‹œ ì •ë³´
                </h3>
                <p className="text-gray-400 text-sm mb-4">ëª¨ì§‘ í˜ì´ì§€ ìƒë‹¨ ì¹´ë“œì— í‘œì‹œë  ìš”ì•½ ì •ë³´ì…ë‹ˆë‹¤.</p>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-white font-medium mb-2">ëª¨ì§‘ ëŒ€ìƒ</label>
                    <input
                      type="text"
                      value={formData.targetAudience}
                      onChange={(e) => setFormData({...formData, targetAudience: e.target.value})}
                      className="w-full bg-gray-700 border border-gray-600 text-white px-4 py-2 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
                      placeholder="ì˜ˆ: êµ­ë¯¼ëŒ€í•™êµ ì¬í•™ìƒ (ì „ í•™ê³¼/í•™ë…„)"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-white font-medium mb-2">ëª¨ì§‘ ì¸ì›</label>
                    <input
                      type="text"
                      value={formData.recruitCount}
                      onChange={(e) => setFormData({...formData, recruitCount: e.target.value})}
                      className="w-full bg-gray-700 border border-gray-600 text-white px-4 py-2 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
                      placeholder="ì˜ˆ: 15ëª… ë‚´ì™¸"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-white font-medium mb-2">ëª¨ì§‘ ë°©ë²•</label>
                    <input
                      type="text"
                      value={formData.recruitMethod}
                      onChange={(e) => setFormData({...formData, recruitMethod: e.target.value})}
                      className="w-full bg-gray-700 border border-gray-600 text-white px-4 py-2 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
                      placeholder="ì˜ˆ: ì„œë¥˜ + ë©´ì ‘"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-white font-medium mb-2">ì§§ì€ ì„¤ëª…</label>
                    <input
                      type="text"
                      value={formData.shortDescription}
                      onChange={(e) => setFormData({...formData, shortDescription: e.target.value})}
                      className="w-full bg-gray-700 border border-gray-600 text-white px-4 py-2 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
                      placeholder="ì˜ˆ: AI Monstersì™€ í•¨ê»˜ ì„±ì¥í•´ë³´ì„¸ìš”!"
                    />
                  </div>
                </div>
              </div>

              <div>
                <label className="block text-white font-medium mb-2">ë‚´ìš© * (Markdown ì§€ì›)</label>
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
                  {/* Markdown ì…ë ¥ */}
                  <div>
                    <div className="flex justify-between items-center mb-2">
                      <label className="block text-sm text-gray-400">âœï¸ í¸ì§‘</label>
                      <button
                        type="button"
                        onClick={loadTemplate}
                        className="text-xs bg-gray-600 hover:bg-gray-500 text-white px-3 py-1 rounded transition-colors"
                      >
                        ğŸ“‹ í…œí”Œë¦¿ ë¶ˆëŸ¬ì˜¤ê¸°
                      </button>
                    </div>
                    <textarea
                      value={formData.bodyMd}
                      onChange={(e) => setFormData({...formData, bodyMd: e.target.value})}
                      className="w-full bg-gray-700 border border-gray-600 text-white px-4 py-2 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent resize-none"
                      rows={16}
                      placeholder="ëª¨ì§‘ ê³µê³  ë‚´ìš©ì„ Markdown í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ì„¸ìš”&#10;&#10;# ì œëª©&#10;## ì†Œì œëª©&#10;- ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ&#10;**êµµì€ ê¸€ì”¨**&#10;*ê¸°ìš¸ì„ ê¸€ì”¨*&#10;[ë§í¬](https://example.com)"
                      required
                    />
                  </div>
                  
                  {/* Markdown ë¯¸ë¦¬ë³´ê¸° */}
                  <div>
                    <label className="block text-sm text-gray-400 mb-2">ğŸ‘€ ë¯¸ë¦¬ë³´ê¸°</label>
                    <div className="bg-gray-800 border border-gray-600 rounded-lg p-4 h-96 overflow-y-auto">
                      {formData.bodyMd ? (
                        <div className="prose prose-invert prose-sm max-w-none">
                          <ReactMarkdown 
                            remarkPlugins={[remarkGfm]}
                            components={{
                              h1: ({children}) => <h1 className="text-2xl font-bold text-white mb-4 border-b border-gray-600 pb-2">{children}</h1>,
                              h2: ({children}) => <h2 className="text-xl font-semibold text-white mb-3 mt-6">{children}</h2>,
                              h3: ({children}) => <h3 className="text-lg font-medium text-white mb-2 mt-4">{children}</h3>,
                              p: ({children}) => <p className="text-gray-300 mb-3 leading-relaxed">{children}</p>,
                              ul: ({children}) => <ul className="text-gray-300 mb-3 pl-4 space-y-1">{children}</ul>,
                              ol: ({children}) => <ol className="text-gray-300 mb-3 pl-4 space-y-1">{children}</ol>,
                              li: ({children}) => <li className="flex items-start"><span className="text-cyan-400 mr-2">â€¢</span><span>{children}</span></li>,
                              strong: ({children}) => <strong className="text-white font-semibold">{children}</strong>,
                              em: ({children}) => <em className="text-cyan-300">{children}</em>,
                              code: ({children}) => <code className="bg-gray-700 text-cyan-300 px-1 py-0.5 rounded text-sm">{children}</code>,
                              pre: ({children}) => <pre className="bg-gray-700 text-cyan-300 p-3 rounded overflow-x-auto text-sm mb-3">{children}</pre>,
                              a: ({href, children}) => <a href={href} className="text-cyan-400 hover:text-cyan-300 underline" target="_blank" rel="noopener noreferrer">{children}</a>,
                              blockquote: ({children}) => <blockquote className="border-l-4 border-cyan-500 pl-4 italic text-gray-400 mb-3">{children}</blockquote>,
                              hr: () => <hr className="border-gray-600 my-4" />
                            }}
                          >
                            {formData.bodyMd}
                          </ReactMarkdown>
                        </div>
                      ) : (
                        <div className="text-gray-500 italic text-center py-8">
                          ì™¼ìª½ì— Markdownì„ ì…ë ¥í•˜ë©´<br />
                          ì—¬ê¸°ì— ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label className="block text-white font-medium mb-2">ëª¨ì§‘ ì‹œì‘ì¼ *</label>
                  <input
                    type="datetime-local"
                    value={formData.startAt}
                    onChange={(e) => setFormData({...formData, startAt: e.target.value})}
                    className="w-full bg-gray-700 border border-gray-600 text-white px-4 py-2 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
                    required
                  />
                </div>
                <div>
                  <label className="block text-white font-medium mb-2">ëª¨ì§‘ ë§ˆê°ì¼ *</label>
                  <input
                    type="datetime-local"
                    value={formData.endAt}
                    onChange={(e) => setFormData({...formData, endAt: e.target.value})}
                    className="w-full bg-gray-700 border border-gray-600 text-white px-4 py-2 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
                    required
                  />
                </div>
              </div>

              <div>
                <label className="block text-white font-medium mb-2">ì™¸ë¶€ ì§€ì› ë§í¬ (ì„ íƒì‚¬í•­)</label>
                <input
                  type="url"
                  value={formData.externalFormUrl}
                  onChange={(e) => setFormData({...formData, externalFormUrl: e.target.value})}
                  className="w-full bg-gray-700 border border-gray-600 text-white px-4 py-2 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-transparent"
                  placeholder="https://forms.google.com/... (ì„ íƒì‚¬í•­)"
                />
              </div>

              <div className="flex items-center space-x-3">
                <input
                  type="checkbox"
                  id="isOpen"
                  checked={formData.isOpen}
                  onChange={(e) => setFormData({...formData, isOpen: e.target.checked})}
                  className="w-4 h-4 text-cyan-600 bg-gray-700 border-gray-600 rounded focus:ring-cyan-500"
                />
                <label htmlFor="isOpen" className="text-white font-medium">
                  ëª¨ì§‘ ê³µê°œ (ì²´í¬ í•´ì œ ì‹œ ëª¨ì§‘ì´ ë§ˆê°ë©ë‹ˆë‹¤)
                </label>
              </div>

      </Modal>

      {/* í™•ì¸ ëŒ€í™”ìƒì */}
      {showConfirmDialog && (
        <div className="absolute inset-0 bg-black/50 flex items-center justify-center z-10">
          <div className="bg-gray-800 border border-gray-700 rounded-lg p-6 max-w-lg w-full mx-4">
                <h3 className="text-lg font-semibold text-white mb-4">
                  ë³€ê²½ì‚¬í•­ì´ ì €ì¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤
                </h3>
                <p className="text-gray-300 mb-6">
                  ì‘ì„±í•˜ì‹  ë‚´ìš©ì— ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤. ì–´ë–»ê²Œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
                </p>
                <div className="flex flex-col gap-3">
                  <button
                    onClick={saveAndClose}
                    className="w-full px-4 py-3 bg-cyan-600 text-white rounded-lg hover:bg-cyan-700 transition-colors font-medium"
                  >
                    ì €ì¥í•˜ê³  ë‹«ê¸°
                  </button>
                  <button
                    onClick={cancelClose}
                    className="w-full px-4 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium"
                  >
                    ê³„ì†í•˜ê¸°
                  </button>
                  <button
                    onClick={confirmClose}
                    className="w-full px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium"
                  >
                    ì €ì¥í•˜ì§€ ì•Šê³  ë‹«ê¸°
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      )}

      {/* í†µí•© ì•Œë¦¼ ëŒ€í™”ìƒì */}
      {notification.show && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4">
          <div className="bg-gray-800 border border-gray-700 rounded-lg p-6 max-w-md w-full mx-4">
            <div className="flex items-center mb-4">
              {notification.type === 'success' && (
                <div className="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center mr-3">
                  <span className="text-white text-sm">âœ“</span>
                </div>
              )}
              {notification.type === 'error' && (
                <div className="w-8 h-8 bg-red-500 rounded-full flex items-center justify-center mr-3">
                  <span className="text-white text-sm">âœ•</span>
                </div>
              )}
              {notification.type === 'warning' && (
                <div className="w-8 h-8 bg-yellow-500 rounded-full flex items-center justify-center mr-3">
                  <span className="text-white text-sm">!</span>
                </div>
              )}
              {notification.type === 'info' && (
                <div className="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center mr-3">
                  <span className="text-white text-sm">i</span>
                </div>
              )}
              <h3 className="text-lg font-semibold text-white">
                {notification.title}
              </h3>
            </div>
            
            {notification.message && (
              <p className="text-gray-300 mb-6">
                {notification.message}
              </p>
            )}
            
            <div className="flex gap-3 justify-end">
              {notification.showCancel && (
                <button
                  onClick={hideNotification}
                  className="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"
                >
                  ì·¨ì†Œ
                </button>
              )}
              <button
                onClick={handleNotificationConfirm}
                className={`px-4 py-2 text-white rounded-lg transition-colors ${
                  notification.type === 'error' ? 'bg-red-600 hover:bg-red-700' :
                  notification.type === 'warning' ? 'bg-yellow-600 hover:bg-yellow-700' :
                  notification.type === 'success' ? 'bg-green-600 hover:bg-green-700' :
                  'bg-cyan-600 hover:bg-cyan-700'
                }`}
              >
                {notification.confirmText}
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  )
}
